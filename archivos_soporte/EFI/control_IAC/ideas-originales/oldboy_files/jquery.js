(function(a){a.fn.lightbox=function(k){var t=a.extend({},a.fn.lightbox.defaults,k);return a(this).live("click",function(){e();o(this);return false;});function e(){a(window).bind("orientationchange",p);a(window).bind("resize",p);a("#overlay").remove();a("#lightbox").remove();t.isIE8=u();t.inprogress=false;if(t.jsonData&&t.jsonData.length>0){var B=t.jsonDataParser?t.jsonDataParser:a.fn.lightbox.parseJsonData;t.imageArray=[];t.imageArray=B(t.jsonData);}var y='<div id="outerImageContainer"><div id="imageContainer"><iframe id="lightboxIframe" /><img id="lightboxImage"><div id="hoverNav"><a href="javascript://" title="'+t.strings.prevLinkTitle+'" id="prevLink"></a><a href="javascript://" id="nextLink" title="'+t.strings.nextLinkTitle+'"></a></div><div id="loading"><a href="javascript://" id="loadingLink"><div id="jqlb_loading"></div></a></div></div></div>';var A='<div id="imageDataContainer" class="clearfix"><div id="imageData"><div id="imageDetails"><span id="caption"></span><span id="numberDisplay"></span></div><div id="bottomNav">';if(t.displayHelp){A+='<span id="helpDisplay">'+t.strings.help+"</span>";}A+='<a href="javascript://" id="bottomNavClose" title="'+t.strings.closeTitle+'"><div id="jqlb_closelabel"></div></a></div></div></div>';var z;if(t.navbarOnTop){z='<div id="overlay"></div><div id="lightbox">'+A+y+"</div>";a("body").append(z);a("#imageDataContainer").addClass("ontop");}else{z='<div id="overlay"></div><div id="lightbox">'+y+A+"</div>";a("body").append(z);}a("#overlay").click(function(){h();}).hide();a("#lightbox").click(function(){h();}).hide();a("#loadingLink").click(function(){h();return false;});a("#bottomNavClose").click(function(){h();return false;});a("#outerImageContainer").width(t.widthCurrent).height(t.heightCurrent);a("#imageDataContainer").width(t.widthCurrent);if(!t.imageClickClose){a("#lightboxImage").click(function(){return false;});a("#hoverNav").click(function(){return false;});}}function p(y){if(t.resizeTimeout){clearTimeout(t.resizeTimeout);t.resizeTimeout=false;}t.resizeTimeout=setTimeout(function(){x(false);},50);}function w(){var y;y=a(document).height();if(t.isIE8&&y>4096){y=4096;}return new Array(a(document).width(),y,a(window).width(),a(window).height(),a(document).height());}function u(){var z=false;if(document.createElement){var y=document.createElement("div");if(y&&y.querySelectorAll){y.innerHTML='<object><param name=""></object>';z=y.querySelectorAll("param").length!=1;}y=null;}return z;}function g(){var z,y;if(self.pageYOffset){y=self.pageYOffset;z=self.pageXOffset;}else{if(document.documentElement&&document.documentElement.scrollTop){y=document.documentElement.scrollTop;z=document.documentElement.scrollLeft;}else{if(document.body){y=document.body.scrollTop;z=document.body.scrollLeft;}}}return new Array(z,y);}function o(C){a("select, embed, object").hide();var A=w();var y=g();var z=0;a("#overlay").hide().css({width:A[0]+"px",height:A[1]+"px",opacity:t.overlayOpacity}).fadeIn(400);if(t.isIE8&&A[1]==4096){if(y[1]>=1000){z=y[1]-1000;if((A[4]-(y[1]+3096))<0){z-=(y[1]+3096)-A[4];}a("#overlay").css({top:z+"px"});}}imageNum=0;if(!t.jsonData){t.imageArray=[];if(!C.rel||(C.rel=="")){var B="";if(C.title){B=C.title;}else{if(a(this).children(":first-child").attr("title")){B=a(this).children(":first-child").attr("title");}}t.imageArray.push(new Array(C.href,t.displayTitle?B:""));}else{a("a").each(function(){if(this.href&&(this.rel==C.rel)){var G="";var E="";var I="";var D=a(this);if(this.title){G=this.title;}else{if(D.children("img:first-child").attr("title")){G=D.children("img:first-child").attr("title");}}if(D.parent().next(".gallery-caption").html()){var H=D.parent().next(".gallery-caption");E=H.html();I=H.text();}else{if(D.next(".wp-caption-text").html()){E=D.next(".wp-caption-text").html();I=D.next(".wp-caption-text").text();}}G=a.trim(G);I=a.trim(I);if(G.toLowerCase()==I.toLowerCase()){G=E;E="";}var F="";if(G!=""&&E!=""){F=G+"<br />"+E;}else{if(G!=""){F=G;}else{if(E!=""){F=E;}}}t.imageArray.push(new Array(this.href,t.displayTitle?F:""));}});}}if(t.imageArray.length>1){for(i=0;i<t.imageArray.length;i++){for(j=t.imageArray.length-1;j>i;j--){if(t.imageArray[i][0]==t.imageArray[j][0]){t.imageArray.splice(j,1);}}}while(t.imageArray[imageNum][0]!=C.href){imageNum++;}}m(y[1],y[0]).show();v(imageNum);}function m(y,z){if(t.resizeSpeed>0){a("#lightbox").animate({top:y},250,"linear");return a("#lightbox").animate({left:z},250,"linear");}return a("#lightbox").css({top:y+"px",left:z+"px"});}function v(y){if(t.inprogress==false){t.inprogress=true;t.activeImage=y;a("#loading").show();a("#lightboxImage").hide();a("#hoverNav").hide();a("#prevLink").hide();a("#nextLink").hide();l();}}function l(){t.imgPreloader=new Image();t.imgPreloader.onload=function(){a("#lightboxImage").attr("src",t.imageArray[t.activeImage][0]);x();f();};t.imgPreloader.src=t.imageArray[t.activeImage][0];}function x(){if(!t.imgPreloader){return;}var B=t.imgPreloader.width;var y=t.imgPreloader.height;var D=w();var J=(D[2]<D[0])?D[0]:D[2];a("#overlay").css({width:J+"px",height:D[1]+"px"});var H=(D[3])-(a("#imageDataContainer").height()+(2*t.borderSize));var I=(D[2])-(2*t.borderSize);if(t.fitToScreen){var z=H-t.marginSize;var K=I-t.marginSize;var E=1;if(y>z){E=z/y;}B=B*E;y=y*E;E=1;if(B>K){E=K/B;}B=Math.round(B*E);y=Math.round(y*E);}var C=g();var A=C[1]+(H*0.5);var F=A-y*0.5;var G=C[0];a("#lightboxImage").width(B).height(y);n(B,y,F,G);}function n(B,z,D,C){t.widthCurrent=a("#outerImageContainer").outerWidth();t.heightCurrent=a("#outerImageContainer").outerHeight();var y=Math.max(350,B+(t.borderSize*2));var A=(z+(t.borderSize*2));t.xScale=(y/t.widthCurrent)*100;t.yScale=(A/t.heightCurrent)*100;m(D,C);c();a("#imageDataContainer").animate({width:y},t.resizeSpeed,"linear");a("#outerImageContainer").animate({width:y},t.resizeSpeed,"linear",function(){a("#outerImageContainer").animate({height:A},t.resizeSpeed,"linear",function(){d();});});r();a("#prevLink").height(z);a("#nextLink").height(z);}function d(){a("#imageData").show();a("#caption").show();a("#loading").hide();if(t.resizeSpeed>0){a("#lightboxImage").fadeIn("fast");}else{a("#lightboxImage").show();}t.inprogress=false;}function f(){if(t.loopImages&&t.imageArray.length>1){preloadNextImage=new Image();preloadNextImage.src=t.imageArray[(t.activeImage==(t.imageArray.length-1))?0:t.activeImage+1][0];preloadPrevImage=new Image();preloadPrevImage.src=t.imageArray[(t.activeImage==0)?(t.imageArray.length-1):t.activeImage-1][0];}else{if((t.imageArray.length-1)>t.activeImage){preloadNextImage=new Image();preloadNextImage.src=t.imageArray[t.activeImage+1][0];}if(t.activeImage>0){preloadPrevImage=new Image();preloadPrevImage.src=t.imageArray[t.activeImage-1][0];}}}function c(){a("#numberDisplay").html("");a("#caption").html("").hide();if(t.imageArray[t.activeImage][1]){a("#caption").html(t.imageArray[t.activeImage][1]).show();}var B="";var A="";var C=(t.imageArray.length>1)?t.strings.image+(t.activeImage+1)+t.strings.of+t.imageArray.length:"";var z=(t.displayDownloadLink)?'<a href="'+t.imageArray[t.activeImage][0]+'" id="downloadLink" target="'+t.linkTarget+'">'+t.strings.download+"</a>":"";var y="";if(t.imageArray.length>1&&!t.disableNavbarLinks){if((t.activeImage)>0||t.loopImages){A='<a title="'+t.strings.prevLinkTitle+'" href="#" id="prevLinkText">'+t.strings.prevLinkText+"</a>";}if(((t.activeImage+1)<t.imageArray.length)||t.loopImages){y+='<a title="'+t.strings.nextLinkTitle+'" href="#" id="nextLinkText">'+t.strings.nextLinkText+"</a>";}}B=A+B+C+z+y;if(B!=""){a("#numberDisplay").html(B).show();}}function r(){if(t.imageArray.length>1){a("#hoverNav").show();if(t.loopImages){a("#prevLink,#prevLinkText").show().click(function(){v((t.activeImage==0)?(t.imageArray.length-1):t.activeImage-1);return false;});a("#nextLink,#nextLinkText").show().click(function(){v((t.activeImage==(t.imageArray.length-1))?0:t.activeImage+1);return false;});}else{if(t.activeImage!=0){a("#prevLink,#prevLinkText").show().click(function(){v(t.activeImage-1);return false;});}if(t.activeImage!=(t.imageArray.length-1)){a("#nextLink,#nextLinkText").show().click(function(){v(t.activeImage+1);return false;});}}b();}}function h(){q();a("#lightbox").hide();a("#overlay").fadeOut();a("select, object, embed").show();}function s(B){var C=B.data.opts;var y=B.keyCode;var z=27;var A=String.fromCharCode(y).toLowerCase();if((A=="x")||(A=="o")||(A=="c")||(y==z)){h();}else{if((A=="p")||(y==37)){if(C.loopImages){q();v((C.activeImage==0)?(C.imageArray.length-1):C.activeImage-1);}else{if(C.activeImage!=0){q();v(C.activeImage-1);}}}else{if((A=="n")||(y==39)){if(t.loopImages){q();v((C.activeImage==(C.imageArray.length-1))?0:C.activeImage+1);}else{if(C.activeImage!=(C.imageArray.length-1)){q();v(C.activeImage+1);}}}}}return false;}function b(){a(document).bind("keydown",{opts:t},s);}function q(){a(document).unbind("keydown");}};a.fn.lightbox.parseJsonData=function(c){var b=[];a.each(c,function(){b.push(new Array(this.url,this.title));});return b;};a.fn.lightbox.defaults={overlayOpacity:0.8,borderSize:10,imageArray:new Array,activeImage:null,inprogress:false,widthCurrent:250,heightCurrent:250,xScale:1,yScale:1,displayTitle:true,disableNavbarLinks:true,loopImages:true,imageClickClose:true,jsonData:null,jsonDataParser:null,followScroll:false,isIE8:false};a(document).ready(function(d){var b=(typeof JQLBSettings=="object");if(b&&JQLBSettings.resizeSpeed){JQLBSettings.resizeSpeed=parseInt(JQLBSettings.resizeSpeed);}if(b&&JQLBSettings.marginSize){JQLBSettings.marginSize=parseInt(JQLBSettings.marginSize);}var c={help:" Browse images with your keyboard: Arrows or P(revious)/N(ext) and X/C/ESC for close.",prevLinkTitle:"previous image",nextLinkTitle:"next image",prevLinkText:"&laquo; Previous",nextLinkText:"Next &raquo;",closeTitle:"close image gallery",image:"Image ",of:" of ",download:"Download"};d('a[rel^="lightbox"]').lightbox({linkTarget:(b&&JQLBSettings.linkTarget.length)?JQLBSettings.linkTarget:"_self",displayHelp:(b&&JQLBSettings.help.length)?true:false,marginSize:(b&&JQLBSettings.marginSize)?JQLBSettings.marginSize:0,fitToScreen:(b&&JQLBSettings.fitToScreen=="1")?true:false,resizeSpeed:(b&&JQLBSettings.resizeSpeed>=0)?JQLBSettings.resizeSpeed:400,displayDownloadLink:(b&&JQLBSettings.displayDownloadLink=="0")?false:true,navbarOnTop:(b&&JQLBSettings.navbarOnTop=="0")?false:true,strings:(b&&typeof JQLBSettings.help=="string")?JQLBSettings:c});});})(jQuery);